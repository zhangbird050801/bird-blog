<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.birdy.mapper.ArticleFavoriteMapper">

    <select id="selectByArticleIdAndUserId" resultType="com.birdy.domain.entity.ArticleFavorite">
        SELECT *
        FROM bg_article_favorite
        WHERE article_id = #{articleId}
          AND user_id = #{userId}
        LIMIT 1
    </select>

    <update id="updateDeletedByArticleIdAndUserId">
        UPDATE bg_article_favorite
        SET deleted = #{deleted},
            update_time = NOW()
        WHERE article_id = #{articleId}
          AND user_id = #{userId}
    </update>

    <select id="selectFavoriteArticlesByUserId" resultType="com.birdy.domain.vo.ArticleVO">
        SELECT 
            a.id,
            a.title,
            a.slug,
            a.summary,
            a.thumbnail,
            a.is_top as isTop,
            a.view_count as viewCount,
            a.like_count as likeCount,
            a.published_time as publishedTime,
            c.name as categoryName
        FROM bg_article_favorite af
        LEFT JOIN bg_article a ON af.article_id = a.id
        LEFT JOIN bg_category c ON a.category_id = c.id
        WHERE af.user_id = #{userId}
          AND af.deleted = 0
          AND a.deleted = 0
          AND a.status = 0
        ORDER BY af.create_time DESC
    </select>

</mapper>
